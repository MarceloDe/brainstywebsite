<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Brainsty ¬∑ GitHub Stars Intelligence Map v2</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap');

    :root {
      --bg: #060810;
      --surface: #0d1117;
      --card: #111827;
      --border: #1f2937;
      --accent: #00d4ff;
      --accent2: #7c3aed;
      --accent3: #10b981;
      --warn: #f59e0b;
      --danger: #ef4444;
      --text: #e2e8f0;
      --muted: #6b7280;
      --bright: #ffffff;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Syne', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    /* HEADER */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(6, 8, 16, 0.92);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 24px;
      flex-wrap: wrap;
    }

    .logo {
      font-family: 'Space Mono', monospace;
      font-size: 16px;
      font-weight: 700;
      color: var(--accent);
      white-space: nowrap;
      letter-spacing: -0.5px;
    }

    .logo span {
      color: var(--muted);
    }

    .header-stats {
      display: flex;
      gap: 16px;
    }

    .hstat {
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      line-height: 1.3;
      color: var(--muted);
      text-align: center;
    }

    .hstat strong {
      color: var(--accent);
      font-size: 15px;
      display: block;
    }

    .search-wrap {
      flex: 1;
      min-width: 200px;
      position: relative;
    }

    .search-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-size: 16px;
    }

    #search {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px 8px 32px;
      color: var(--text);
      font-family: 'Space Mono', monospace;
      font-size: 12px;
      outline: none;
      transition: border-color 0.2s;
    }

    #search:focus {
      border-color: var(--accent);
    }

    .header-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .hdr-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .hdr-btn:hover {
      background: var(--border);
      border-color: var(--accent);
      color: var(--accent);
    }

    .hdr-btn.primary {
      background: var(--accent)18;
      border-color: var(--accent)66;
      color: var(--accent);
    }

    .hdr-btn.primary:hover {
      background: var(--accent)30;
    }

    .hdr-btn.success {
      background: #10b98118;
      border-color: #10b98166;
      color: #10b981;
    }

    .hdr-btn.success:hover {
      background: #10b98130;
    }

    .hdr-btn.warn {
      background: #f59e0b18;
      border-color: #f59e0b66;
      color: #f59e0b;
    }

    .hdr-btn.warn:hover {
      background: #f59e0b30;
    }

    /* LAYOUT */
    .container {
      position: relative;
      z-index: 1;
      display: grid;
      grid-template-columns: 240px 1fr;
      gap: 0;
      min-height: calc(100vh - 60px);
    }

    /* SIDEBAR */
    aside {
      border-right: 1px solid var(--border);
      padding: 16px;
      overflow-y: auto;
      height: calc(100vh - 60px);
      position: sticky;
      top: 60px;
      background: rgba(13, 17, 23, 0.6);
    }

    .sidebar-section {
      margin-bottom: 24px;
    }

    .sidebar-section h3 {
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .cat-btn {
      width: 100%;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 6px;
      color: var(--muted);
      font-family: 'Syne', sans-serif;
      font-size: 12px;
      padding: 6px 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.15s;
      text-align: left;
    }

    .cat-btn:hover {
      background: var(--border);
      color: var(--text);
    }

    .cat-btn.active {
      background: var(--accent)15;
      border-color: var(--accent)40;
      color: var(--text);
    }

    .cat-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .cat-count {
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      color: var(--muted);
    }

    .fitness-filter {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .fit-btn {
      flex: 1;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--muted);
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      padding: 5px 4px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .fit-btn:hover {
      border-color: var(--accent);
      color: var(--text);
    }

    .fit-btn.active {
      background: var(--accent)15;
      border-color: var(--accent);
      color: var(--accent);
    }

    /* CATEGORY CHART */
    .cat-bar-row {
      display: grid;
      grid-template-columns: 110px 1fr 24px;
      align-items: center;
      gap: 6px;
      margin-bottom: 5px;
    }

    .cat-bar-label {
      font-size: 10px;
      color: var(--muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .cat-bar-track {
      height: 5px;
      background: var(--border);
      border-radius: 3px;
      overflow: hidden;
    }

    .cat-bar-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.4s ease;
    }

    .cat-bar-num {
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      color: var(--muted);
      text-align: right;
    }

    /* MAIN */
    main {
      padding: 16px 20px;
      overflow-y: auto;
    }

    .toolbar {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .view-toggle {
      display: flex;
      gap: 6px;
    }

    .view-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--muted);
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .view-btn:hover {
      border-color: var(--accent);
      color: var(--text);
    }

    .view-btn.active {
      background: var(--accent)15;
      border-color: var(--accent);
      color: var(--accent);
    }

    .result-count {
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      color: var(--muted);
      margin-left: 8px;
    }

    /* GRID */
    #grid-view {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }

    .repo-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
      border-top: 2px solid var(--cat-color, var(--border));
    }

    .repo-card:hover {
      border-color: var(--cat-color, var(--accent));
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      transform: translateY(-2px);
    }

    .card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 8px;
      gap: 8px;
    }

    .repo-name {
      font-size: 13px;
      font-weight: 700;
      line-height: 1.3;
    }

    .repo-name a {
      color: var(--bright);
      text-decoration: none;
    }

    .repo-name a:hover {
      color: var(--accent);
    }

    .fitness-badge {
      font-family: 'Space Mono', monospace;
      font-size: 13px;
      flex-shrink: 0;
    }

    .card-tldr {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 10px;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 10px;
    }

    .tag {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 20px;
      border: 1px solid;
      font-family: 'Space Mono', monospace;
      white-space: nowrap;
    }

    .card-actions {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .innovation-btn {
      background: var(--accent2)18;
      border: 1px solid var(--accent2)40;
      color: #a78bfa;
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      padding: 4px 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
      white-space: nowrap;
    }

    .innovation-btn:hover {
      background: var(--accent2)30;
      border-color: var(--accent2);
    }

    .import-btn {
      background: #10b98115;
      border: 1px solid #10b98140;
      color: #10b981;
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      padding: 4px 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .import-btn:hover {
      background: #10b98125;
      border-color: #10b981;
    }

    .card-footer {
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      color: var(--muted);
      border-top: 1px solid var(--border);
      padding-top: 8px;
      margin-top: auto;
    }

    .lang-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .stars-count {
      margin-left: auto;
      color: var(--warn);
    }

    /* TABLE */
    #table-view {
      display: none;
      overflow-x: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    .data-table th {
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 1px solid var(--border);
      padding: 10px 12px;
      text-align: left;
      cursor: pointer;
      white-space: nowrap;
    }

    .data-table th:hover {
      color: var(--accent);
    }

    .data-table td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border)60;
      vertical-align: top;
    }

    .data-table tr:hover td {
      background: var(--border)30;
    }

    .data-table a {
      color: var(--accent);
      text-decoration: none;
    }

    .data-table a:hover {
      text-decoration: underline;
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ UPDATE PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .update-panel {
      display: none;
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 460px;
      max-width: 100vw;
      background: var(--surface);
      border-left: 1px solid var(--border);
      z-index: 200;
      flex-direction: column;
      box-shadow: -8px 0 40px rgba(0, 0, 0, 0.6);
    }

    .update-panel.open {
      display: flex;
    }

    .panel-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .panel-header h2 {
      font-size: 15px;
      color: var(--bright);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-close {
      background: transparent;
      border: none;
      color: var(--muted);
      font-size: 18px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .panel-close:hover {
      color: var(--text);
      background: var(--border);
    }

    .panel-tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .ptab {
      flex: 1;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--muted);
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      padding: 10px 8px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .ptab:hover {
      color: var(--text);
    }

    .ptab.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    .panel-body {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .panel-section {
      margin-bottom: 28px;
    }

    .panel-section h3 {
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 12px;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--border);
    }

    .panel-section p {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .panel-section code {
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 2px 5px;
      color: var(--accent);
    }

    .input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .panel-input {
      flex: 1;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 12px;
      color: var(--text);
      font-family: 'Space Mono', monospace;
      font-size: 12px;
      outline: none;
    }

    .panel-input:focus {
      border-color: var(--accent);
    }

    .panel-input::placeholder {
      color: var(--muted);
    }

    .panel-select {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 10px;
      color: var(--text);
      font-family: 'Space Mono', monospace;
      font-size: 12px;
      outline: none;
      cursor: pointer;
    }

    .action-btn {
      background: var(--accent)18;
      border: 1px solid var(--accent)50;
      color: var(--accent);
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .action-btn:hover {
      background: var(--accent)30;
    }

    .action-btn.green {
      background: #10b98118;
      border-color: #10b98150;
      color: #10b981;
    }

    .action-btn.green:hover {
      background: #10b98130;
    }

    .action-btn.purple {
      background: var(--accent2)18;
      border-color: var(--accent2)50;
      color: #a78bfa;
    }

    .action-btn.purple:hover {
      background: var(--accent2)30;
    }

    .action-btn.orange {
      background: #f59e0b18;
      border-color: #f59e0b50;
      color: #f59e0b;
    }

    .action-btn.orange:hover {
      background: #f59e0b30;
    }

    .action-btn.red {
      background: #ef444418;
      border-color: #ef444450;
      color: #ef4444;
    }

    .action-btn.red:hover {
      background: #ef444430;
    }

    .action-btn.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .connector-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .connector-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .connector-card:hover {
      border-color: var(--accent);
    }

    .connector-card.selected {
      border-color: var(--accent);
      background: var(--accent)0d;
    }

    .connector-card .cc-icon {
      font-size: 24px;
      margin-bottom: 6px;
    }

    .connector-card .cc-name {
      font-size: 12px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 3px;
    }

    .connector-card .cc-desc {
      font-size: 10px;
      color: var(--muted);
    }

    .status-log {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px;
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      min-height: 80px;
      max-height: 200px;
      overflow-y: auto;
      line-height: 1.6;
    }

    .log-line {
      margin-bottom: 2px;
    }

    .log-line.ok {
      color: #10b981;
    }

    .log-line.err {
      color: #ef4444;
    }

    .log-line.info {
      color: var(--accent);
    }

    .log-line.warn {
      color: #f59e0b;
    }

    .progress-bar-wrap {
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      margin: 10px 0;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: var(--accent);
      border-radius: 2px;
      transition: width 0.3s;
      width: 0%;
    }

    /* IMPORT PANEL (per-repo) */
    .import-panel-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 300;
      align-items: center;
      justify-content: center;
    }

    .import-panel-overlay.open {
      display: flex;
    }

    .import-panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      width: 520px;
      max-width: calc(100vw - 40px);
      max-height: 80vh;
      overflow-y: auto;
      padding: 28px;
      position: relative;
    }

    .import-panel h2 {
      font-size: 16px;
      color: var(--bright);
      margin-bottom: 6px;
    }

    .import-panel .repo-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 4px 12px;
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      color: var(--accent);
      margin-bottom: 20px;
    }

    .import-method-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 20px;
    }

    .import-method {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }

    .import-method:hover {
      border-color: var(--accent);
      background: var(--accent)06;
    }

    .import-method .im-icon {
      font-size: 20px;
      margin-bottom: 6px;
    }

    .im-name {
      font-size: 12px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 4px;
    }

    .im-desc {
      font-size: 11px;
      color: var(--muted);
      line-height: 1.4;
    }

    .im-badge {
      font-size: 9px;
      font-family: 'Space Mono', monospace;
      padding: 2px 6px;
      border-radius: 3px;
      margin-top: 6px;
      display: inline-block;
    }

    .im-badge.instant {
      background: #10b98120;
      color: #10b981;
      border: 1px solid #10b98140;
    }

    .im-badge.external {
      background: #f59e0b20;
      color: #f59e0b;
      border: 1px solid #f59e0b40;
    }

    .im-badge.manual {
      background: #6b728020;
      color: #9ca3af;
      border: 1px solid #6b728040;
    }

    .import-result-box {
      display: none;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px;
      margin-top: 14px;
    }

    .import-result-box.visible {
      display: block;
    }

    .import-result-box h4 {
      font-size: 12px;
      font-family: 'Space Mono', monospace;
      color: var(--accent);
      margin-bottom: 8px;
    }

    .import-result-box textarea {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px;
      color: var(--text);
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      resize: vertical;
      min-height: 120px;
      outline: none;
      line-height: 1.5;
    }

    .copy-confirm {
      font-size: 11px;
      color: #10b981;
      display: none;
      margin-top: 6px;
      font-family: 'Space Mono', monospace;
    }

    /* MODAL */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      z-index: 150;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.open {
      display: flex;
    }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 28px;
      width: 540px;
      max-width: calc(100vw - 40px);
      max-height: 85vh;
      overflow-y: auto;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: var(--border);
      border: none;
      color: var(--text);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      background: var(--danger);
    }

    .modal h2 {
      font-size: 18px;
      color: var(--bright);
      margin-bottom: 4px;
      padding-right: 32px;
    }

    .modal h2 a {
      color: var(--accent);
      text-decoration: none;
    }

    .modal-sub {
      font-family: 'Space Mono', monospace;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 20px;
    }

    .modal-section {
      margin-bottom: 18px;
    }

    .modal-section h4 {
      font-size: 11px;
      font-family: 'Space Mono', monospace;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .modal-section p {
      font-size: 13px;
      line-height: 1.6;
    }

    .innovation-box {
      background: var(--accent2)10;
      border: 1px solid var(--accent2)30;
      border-radius: 8px;
      padding: 12px;
      font-size: 13px;
      line-height: 1.6;
      color: #c4b5fd;
    }

    /* NOTIFICATION TOAST */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 999;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 18px;
      font-family: 'Space Mono', monospace;
      font-size: 12px;
      color: var(--text);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      gap: 8px;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      pointer-events: none;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.ok {
      border-color: #10b98160;
      color: #10b981;
    }

    .toast.err {
      border-color: #ef444460;
      color: #ef4444;
    }

    .toast.info {
      border-color: var(--accent)60;
      color: var(--accent);
    }

    /* SYNC SPINNER */
    .spin {
      display: inline-block;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* MISC */
    ::-webkit-scrollbar {
      width: 5px;
      height: 5px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px;
    }

    .repo-card {
      animation: fadeUp 0.3s ease both;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(8px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
      font-family: 'Space Mono', monospace;
      font-size: 13px;
      grid-column: 1/-1;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 12px;
      border: 1px solid;
    }

    .edit-inline {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 4px 6px;
      color: var(--text);
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      outline: none;
      width: 100%;
    }

    .edit-inline:focus {
      border-color: var(--accent);
    }

    /* Add repo form */
    .add-repo-form {
      display: none;
    }

    .add-repo-form.open {
      display: block;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .form-group label {
      font-size: 10px;
      font-family: 'Space Mono', monospace;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Firebase UI additions */
    #token-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--muted);
      display: inline-block;
      margin-right: 6px;
    }

    #token-indicator.active {
      background: var(--accent3);
      box-shadow: 0 0 8px var(--accent3);
    }

    .new-badge {
      background: var(--accent);
      color: var(--bg);
      font-size: 9px;
      font-weight: 800;
      padding: 1px 4px;
      border-radius: 3px;
      margin-left: 6px;
    }
  </style>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-auth-compat.js"></script>
</head>

<body>
  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <!-- HEADER -->
  <header>
    <div class="logo">BRAINSTY <span>//</span> Stars Map <span
        style="font-size:9px;background:#10b98120;border:1px solid #10b98140;color:#10b981;padding:2px 6px;border-radius:3px;margin-left:6px">v2</span>
      <span id="token-indicator" title="GitHub Token Status"></span>
    </div>
    <div class="header-stats">
      <div class="hstat"><strong id="total-count">...</strong><br>repos</div>
      <div class="hstat"><strong id="fit5-count">...</strong><br>fitness-5</div>
      <div class="hstat"><strong id="fit4-count">...</strong><br>fitness-4</div>
      <div class="hstat"><strong id="cat-count">...</strong><br>categories</div>
    </div>
    <div class="search-wrap">
      <span class="search-icon">‚åï</span>
      <input id="search" type="text" placeholder="search repos, ideas, categories‚Ä¶">
    </div>
    <div class="header-actions">
      <button class="hdr-btn success" onclick="openUpdatePanel('sync')">‚ü≥ Sync Stars</button>
      <button class="hdr-btn primary" onclick="openUpdatePanel('add')">Ôºã Add Repo</button>
      <button class="hdr-btn warn" onclick="openUpdatePanel('export')">‚¨á Export JSON</button>
      <button class="hdr-btn" onclick="openUpdatePanel('connectors')">‚ö° Connectors</button>
    </div>
  </header>

  <div class="container">
    <!-- SIDEBAR -->
    <aside>
      <div class="sidebar-section">
        <h3>Categories</h3>
        <button class="cat-btn active" data-cat="ALL" style="margin-bottom:4px;">
          <span style="display:flex;align-items:center;gap:8px;">
            <span class="cat-dot" style="background:#6b7280"></span>ALL
          </span>
          <span class="cat-count" id="all-count">...</span>
        </button>
        <div id="cat-list"></div>
      </div>

      <div class="sidebar-section">
        <h3>Min Fitness</h3>
        <div class="fitness-filter">
          <button class="fit-btn active" data-min="0">Any</button>
          <button class="fit-btn" data-min="3">3+</button>
          <button class="fit-btn" data-min="4">4+</button>
          <button class="fit-btn" data-min="5">5 only</button>
        </div>
      </div>

      <div class="sidebar-section">
        <h3>Distribution</h3>
        <div id="cat-chart"></div>
      </div>
    </aside>

    <!-- MAIN -->
    <main>
      <div class="toolbar">
        <div class="view-toggle">
          <button class="view-btn active" data-view="grid">‚äû Grid</button>
          <button class="view-btn" data-view="table">‚â° Table</button>
        </div>
        <span class="result-count" id="result-count"></span>
      </div>

      <div id="grid-view"></div>
      <div id="table-view">
        <table class="data-table">
          <thead>
            <tr>
              <th data-sort="full_name">Repo</th>
              <th data-sort="fitness">Fitness</th>
              <th data-sort="stars">Stars</th>
              <th>Language</th>
              <th>Categories</th>
              <th>Innovation</th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>
    </main>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UPDATE / MANAGE PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="update-panel" id="update-panel">
    <div class="panel-header">
      <h2>‚öô Manage Database</h2>
      <button class="panel-close" onclick="closeUpdatePanel()">‚úï</button>
    </div>
    <div class="panel-tabs">
      <button class="ptab active" data-tab="sync" onclick="switchTab('sync',this)">‚ü≥ Sync</button>
      <button class="ptab" data-tab="add" onclick="switchTab('add',this)">Ôºã Add</button>
      <button class="ptab" data-tab="edit" onclick="switchTab('edit',this)">‚úè Edit</button>
      <button class="ptab" data-tab="export" onclick="switchTab('export',this)">‚¨á Export</button>
      <button class="ptab" data-tab="connectors" onclick="switchTab('connectors',this)">‚ö° Connectors</button>
    </div>
    <div class="panel-body">

      <!-- TAB: SYNC -->
      <div id="tab-sync" class="panel-section" style="margin-bottom:0">
        <div class="panel-section">
          <h3>üåå Full Galaxy Sync</h3>
          <p>The "Everything" button. Fetches your latest GitHub stars, discovers new repos you haven't added yet,
            auto-classifies them, and refreshes star counts for existing ones. <strong>Requires GitHub Token.</strong>
          </p>
          <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap">
            <button class="action-btn purple" onclick="syncStars()">üöÄ Run Full Galaxy Sync</button>
            <button class="action-btn" onclick="syncSingle()">üéØ Sync Single Repo</button>
          </div>
          <div class="input-row" id="single-sync-row" style="display:none">
            <input class="panel-input" id="single-sync-input" placeholder="owner/repo (e.g. langchain-ai/langgraph)">
            <button class="action-btn green" onclick="doSyncSingle()">Go</button>
          </div>
          <div class="progress-bar-wrap" id="sync-progress-wrap" style="display:none">
            <div class="progress-bar" id="sync-progress"></div>
          </div>
          <div class="status-log" id="sync-log">Waiting for ignition‚Ä¶</div>
        </div>

        <div class="panel-section">
          <h3>üì° Fetch Repo Metadata</h3>
          <p>Pulls description, language, topics, and last-push date for all repos via GitHub's public API. Updates the
            in-memory database.</p>
          <button class="action-btn" onclick="syncMeta()">üì° Fetch Metadata</button>
        </div>
      </div>

      <!-- TAB: ADD -->
      <div id="tab-add" class="panel-section" style="display:none;margin-bottom:0">
        <div class="panel-section">
          <h3>‚ûï Add New Repository</h3>
          <p>Paste a GitHub URL or <code>owner/repo</code> slug. Brainsty will fetch the metadata and add it to the
            database.</p>
          <div class="input-row">
            <input class="panel-input" id="add-repo-input" placeholder="github.com/owner/repo or owner/repo">
            <button class="action-btn green" onclick="addRepo()">Add</button>
          </div>
          <div class="status-log" id="add-log" style="min-height:50px">Ready to add repos‚Ä¶</div>
        </div>

        <div class="panel-section">
          <h3>üìã Bulk Import (JSON)</h3>
          <p>Paste a JSON array of repos (same schema as export). Each item needs at minimum <code>full_name</code>.
            Existing repos by same name will be updated.</p>
          <textarea class="panel-input" id="bulk-json-input" rows="6"
            style="resize:vertical;font-size:11px;line-height:1.5"
            placeholder='[{"full_name":"owner/repo","fitness":4,"categories":["AGENTIC_ORCHESTRATION"],"tldr":"..."}]'></textarea>
          <button class="action-btn purple" onclick="bulkImport()" style="margin-top:8px">‚¨Ü Import JSON</button>
        </div>
      </div>

      <!-- TAB: EDIT -->
      <div id="tab-edit" class="panel-section" style="display:none;margin-bottom:0">
        <div class="panel-section">
          <h3>‚úè Edit Repo Record</h3>
          <p>Search for a repo and edit its fitness score, categories, innovation idea, or description.</p>
          <div class="input-row">
            <input class="panel-input" id="edit-search-input" placeholder="Search repos to edit‚Ä¶"
              oninput="filterEditList()">
          </div>
          <div id="edit-list"
            style="max-height:200px;overflow-y:auto;border:1px solid var(--border);border-radius:6px;margin-bottom:12px">
          </div>
          <div id="edit-form" style="display:none">
            <input type="hidden" id="edit-full-name">
            <div class="form-grid">
              <div class="form-group">
                <label>Fitness (0‚Äì5)</label>
                <select class="panel-select edit-inline" id="ef-fitness" style="width:100%">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                </select>
              </div>
              <div class="form-group">
                <label>Language</label>
                <input class="edit-inline" id="ef-language" placeholder="Python">
              </div>
            </div>
            <div class="form-group" style="margin-bottom:10px">
              <label>Summary (tldr)</label>
              <input class="edit-inline" id="ef-tldr" placeholder="Short description">
            </div>
            <div class="form-group" style="margin-bottom:10px">
              <label>Categories (comma-separated)</label>
              <input class="edit-inline" id="ef-categories" placeholder="AGENTIC_ORCHESTRATION,MCP_INTEGRATION">
            </div>
            <div class="form-group" style="margin-bottom:12px">
              <label>Innovation Idea</label>
              <textarea class="edit-inline" id="ef-innovation" rows="3" style="resize:vertical"></textarea>
            </div>
            <div style="display:flex;gap:8px">
              <button class="action-btn green" onclick="saveEdit()">üíæ Save Changes</button>
              <button class="action-btn red" onclick="deleteRepo()" style="margin-left:auto">üóë Delete</button>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB: EXPORT -->
      <div id="tab-export" class="panel-section" style="display:none;margin-bottom:0">
        <div class="panel-section">
          <h3>‚¨á Export Database</h3>
          <p>Download the current in-memory repo database as a JSON file. This captures any edits, synced star counts,
            or newly added repos.</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="action-btn green" onclick="exportJSON()">‚¨á Download repos.json</button>
            <button class="action-btn" onclick="copyJSON()">üìã Copy JSON to Clipboard</button>
          </div>
        </div>
        <div class="panel-section">
          <h3>üìÑ Export Full HTML</h3>
          <p>Generates a standalone self-contained HTML file with all current data embedded. Open in any browser ‚Äî no
            server needed.</p>
          <button class="action-btn purple" onclick="exportHTML()">üìÑ Download Updated HTML</button>
        </div>
        <div class="panel-section">
          <h3>üóÉ Export as CSV</h3>
          <p>Comma-separated format. Compatible with Excel, Google Sheets, or any spreadsheet tool.</p>
          <button class="action-btn orange" onclick="exportCSV()">üóÉ Download repos.csv</button>
        </div>
      </div>

      <!-- TAB: CONNECTORS -->
      <div id="tab-connectors" class="panel-section" style="display:none;margin-bottom:0">
        <div class="panel-section">
          <h3>‚ö° Claude RAG Connectors</h3>
          <p>Each connector lets you import a repo into Claude's context for use as a RAG source. The "Import to Claude"
            button on each card uses whichever connector is selected here.</p>
          <div class="connector-grid">
            <div class="connector-card selected" id="cc-clipboard" onclick="selectConnector('clipboard',this)">
              <div class="cc-icon">üìã</div>
              <div class="cc-name">Copy Context</div>
              <div class="cc-desc">Copies README + metadata to clipboard. Paste into any Claude chat.</div>
            </div>
            <div class="connector-card" id="cc-download" onclick="selectConnector('download',this)">
              <div class="cc-icon">‚¨á</div>
              <div class="cc-name">Download .md</div>
              <div class="cc-desc">Downloads a markdown context file. Upload to Claude.ai as a document.</div>
            </div>
            <div class="connector-card" id="cc-claude-web" onclick="selectConnector('claude-web',this)">
              <div class="cc-icon">üåê</div>
              <div class="cc-name">Claude.ai (Web)</div>
              <div class="cc-desc">Opens Claude.ai with repo URL pre-loaded as context using URL scheme.</div>
            </div>
            <div class="connector-card" id="cc-mcp" onclick="selectConnector('mcp',this)">
              <div class="cc-icon">üîå</div>
              <div class="cc-name">MCP Config</div>
              <div class="cc-desc">Generates claude_desktop_config.json snippet for Claude Desktop.</div>
            </div>
            <div class="connector-card" id="cc-git-mcp" onclick="selectConnector('git-mcp',this)">
              <div class="cc-icon">üêô</div>
              <div class="cc-name">git-mcp Server</div>
              <div class="cc-desc">Uses git-mcp.com ‚Äî turn any public GitHub repo into an MCP endpoint.</div>
            </div>
            <div class="connector-card" id="cc-github-dev" onclick="selectConnector('github-dev',this)">
              <div class="cc-icon">üíª</div>
              <div class="cc-name">github.dev</div>
              <div class="cc-desc">Opens repo in VS Code Web Editor for manual context extraction.</div>
            </div>
          </div>
          <div
            style="margin-top:16px;padding:12px;background:var(--bg);border:1px solid var(--border);border-radius:8px;">
            <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--accent);margin-bottom:6px">ACTIVE
              CONNECTOR</div>
            <div id="active-connector-desc" style="font-size:12px;color:var(--muted)">üìã Copy Context ‚Äî fetches README
              and copies formatted context to clipboard for pasting into Claude.</div>
          </div>
        </div>

        <div class="panel-section">
          <h3>üì¶ Batch Import Selected Repos</h3>
          <p>Select repos by fitness, then batch-import them all at once using the active connector.</p>
          <div class="input-row">
            <select class="panel-select" id="batch-fitness">
              <option value="5">Fitness 5 only</option>
              <option value="4">Fitness 4+</option>
              <option value="3">Fitness 3+</option>
              <option value="0">All repos</option>
            </select>
            <button class="action-btn green" onclick="batchImport()">‚ö° Batch Import</button>
          </div>
          <div class="status-log" id="batch-log" style="min-height:50px">Select a fitness level and click Batch Import‚Ä¶
          </div>
        </div>

        <div class="panel-section">
          <h3>ü§ñ GitHub Token (optional)</h3>
          <p>Provide a GitHub Personal Access Token to increase the API rate limit from 60 to 5,000 requests/hour.
            Stored only in sessionStorage.</p>
          <div class="input-row">
            <input class="panel-input" id="gh-token" type="password" placeholder="ghp_‚Ä¶">
            <button class="action-btn" onclick="saveToken()">Save</button>
          </div>
          <div style="font-size:11px;color:var(--muted)">Token is stored in session only and never sent anywhere except
            api.github.com.</div>
        </div>
      </div>

    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê IMPORT-TO-CLAUDE PANEL (per card) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="import-panel-overlay" id="import-panel-overlay">
    <div class="import-panel">
      <button class="modal-close" onclick="closeImportPanel()" style="position:absolute;top:16px;right:16px">‚úï</button>
      <h2>Import to Claude</h2>
      <div id="import-repo-badge" class="repo-badge"></div>
      <div class="import-method-grid">
        <div class="import-method" onclick="doImport('clipboard')">
          <div class="im-icon">üìã</div>
          <div class="im-name">Copy Context</div>
          <div class="im-desc">Fetch README, copy formatted context to clipboard. Paste into Claude.</div>
          <span class="im-badge instant">Instant</span>
        </div>
        <div class="import-method" onclick="doImport('download')">
          <div class="im-icon">‚¨á</div>
          <div class="im-name">Download .md</div>
          <div class="im-desc">Download a context pack (.md) then upload to Claude.ai.</div>
          <span class="im-badge instant">Download</span>
        </div>
        <div class="import-method" onclick="doImport('claude-web')">
          <div class="im-icon">üåê</div>
          <div class="im-name">Open Claude.ai</div>
          <div class="im-desc">Open Claude.ai with a pre-built prompt and the repo URL.</div>
          <span class="im-badge external">Opens Tab</span>
        </div>
        <div class="import-method" onclick="doImport('mcp')">
          <div class="im-icon">üîå</div>
          <div class="im-name">MCP Config</div>
          <div class="im-desc">Generate Claude Desktop MCP config snippet (claude_desktop_config.json).</div>
          <span class="im-badge manual">Desktop</span>
        </div>
        <div class="import-method" onclick="doImport('git-mcp')">
          <div class="im-icon">üêô</div>
          <div class="im-name">git-mcp Server</div>
          <div class="im-desc">Use git-mcp.com to expose any public GitHub repo as an MCP endpoint.</div>
          <span class="im-badge external">Opens Tab</span>
        </div>
        <div class="import-method" onclick="doImport('github-dev')">
          <div class="im-icon">üíª</div>
          <div class="im-name">github.dev</div>
          <div class="im-desc">Open in VS Code Web editor for manual browsing and copying.</div>
          <span class="im-badge external">Opens Tab</span>
        </div>
      </div>
      <div class="import-result-box" id="import-result-box">
        <h4 id="import-result-title">Context Ready</h4>
        <textarea id="import-result-text" readonly rows="8"></textarea>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="action-btn green" onclick="copyImportResult()">üìã Copy to Clipboard</button>
          <button class="action-btn" onclick="downloadImportResult()">‚¨á Download</button>
        </div>
        <div class="copy-confirm" id="copy-confirm">‚úì Copied to clipboard!</div>
      </div>
      <div class="status-log" id="import-log" style="min-height:40px;margin-top:10px">Select an import method above‚Ä¶
      </div>
    </div>
  </div>

  <!-- DETAIL MODAL -->
  <div class="modal-overlay" id="modal">
    <div class="modal">
      <button class="modal-close" id="modal-close">‚úï</button>
      <h2 id="m-name"></h2>
      <div class="modal-sub" id="m-sub"></div>
      <div class="modal-section">
        <h4>Summary</h4>
        <p id="m-tldr"></p>
      </div>
      <div class="modal-section" id="m-inno-section">
        <h4>üß† Brainsty Innovation Idea</h4>
        <div class="innovation-box" id="m-inno"></div>
      </div>
      <div class="modal-section">
        <h4>Categories</h4>
        <div id="m-cats" class="card-tags"></div>
      </div>
      <div class="modal-section" style="margin-top:16px;border-top:1px solid var(--border);padding-top:16px">
        <button class="action-btn green" id="m-import-btn" onclick="openImportFromModal()">‚¨Ü Import to Claude
          (RAG)</button>
      </div>
    </div>
  </div>
  <!-- Firebase SDK CDN scripts -->
  <script>
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Placeholder for Firebase Config - USER MUST FILL THIS
    const firebaseConfig = {
      "storageBucket": "studio-2671301810-e0a76.firebasestorage.app",
      "apiKey": "AIzaSyDC886khiOxX49cam0F9QfIUJzzmsvBSgU",
      "authDomain": "studio-2671301810-e0a76.firebaseapp.com",
      "messagingSenderId": "381571846140",
      "projectId": "studio-2671301810-e0a76"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Debugging Firestore connection
    db.settings({ experimentalForceLongPolling: true });

    // LOG PROJECT ID FOR VERIFICATION
    setTimeout(() => {
      logLine('sync-log', `üîç Firebase Project: ${firebase.app().options.projectId}`, 'info');
    }, 1000);

    let REPOS = []; // Now populated from Firestore

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const CAT_COLORS = {
      AGENTIC_ORCHESTRATION: '#00d4ff', LLM_INFRASTRUCTURE: '#7c3aed',
      CODING_WORKFLOW: '#10b981', MCP_INTEGRATION: '#f59e0b',
      FRONTEND_UI: '#ec4899', RESEARCH_SEARCH: '#06b6d4',
      DATA_EXTRACTION: '#84cc16', REASONING_IMPROVEMENT: '#8b5cf6',
      BROWSER_AUTOMATION: '#f97316', KNOWLEDGE_GRAPH: '#14b8a6',
      HEALTHCARE_DOMAIN: '#ef4444', MEMORY_SYSTEMS: '#a78bfa',
      OCR_DOCUMENT: '#fbbf24',
    };
    const CAT_LABELS = {
      AGENTIC_ORCHESTRATION: 'Agentic Orchestration', LLM_INFRASTRUCTURE: 'LLM Infrastructure',
      CODING_WORKFLOW: 'Coding Workflow', MCP_INTEGRATION: 'MCP Integration',
      FRONTEND_UI: 'Frontend / UI', RESEARCH_SEARCH: 'Research & Search',
      DATA_EXTRACTION: 'Data Extraction', REASONING_IMPROVEMENT: 'Reasoning',
      BROWSER_AUTOMATION: 'Browser Automation', KNOWLEDGE_GRAPH: 'Knowledge Graph',
      HEALTHCARE_DOMAIN: 'Healthcare Domain', MEMORY_SYSTEMS: 'Memory Systems',
      OCR_DOCUMENT: 'OCR & Documents',
    };

    function autoClassify(repo) {
      const text = (repo.full_name + ' ' + (repo.tldr || '') + ' ' + (repo.description || '')).toLowerCase();
      const categories = [];
      const rules = {
        AGENTIC_ORCHESTRATION: ['agent', 'orchestration', 'langgraph', 'autogen', 'crewai'],
        LLM_INFRASTRUCTURE: ['llm', 'infrastructure', 'platform', 'model', 'serve'],
        CODING_WORKFLOW: ['code', 'programming', 'developer', 'tool', 'workflow'],
        MCP_INTEGRATION: ['mcp', 'model context protocol'],
        FRONTEND_UI: ['ui', 'frontend', 'component', 'design', 'web'],
        RESEARCH_SEARCH: ['search', 'research', 'rag', 'vector'],
        DATA_EXTRACTION: ['scrape', 'extract', 'parse', 'data'],
        REASONING_IMPROVEMENT: ['reasoning', 'logic', 'thought', 'chain-of-thought'],
        BROWSER_AUTOMATION: ['browser', 'selenium', 'playwright', 'automate'],
        KNOWLEDGE_GRAPH: ['graph', 'knowledge', 'neo4j', 'ontology'],
        HEALTHCARE_DOMAIN: ['medical', 'health', 'clinical', 'doctor'],
        MEMORY_SYSTEMS: ['memory', 'long-term', 'state'],
        OCR_DOCUMENT: ['ocr', 'pdf', 'document', 'vision']
      };

      for (const [cat, keywords] of Object.entries(rules)) {
        if (keywords.some(kw => text.includes(kw))) {
          categories.push(cat);
        }
      }
      return categories;
    }
    const LANG_COLORS = {
      Python: '#3572A5', TypeScript: '#2b7489', JavaScript: '#f1e05a',
      Go: '#00ADD8', Rust: '#dea584', Shell: '#89e051', HTML: '#e34c26',
      'Jupyter Notebook': '#DA5B0B', Scala: '#c22d40', Ruby: '#701516',
      Dart: '#00B4AB', Swift: '#F05138', MATLAB: '#e16737', 'C#': '#178600', C: '#555555',
    };

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let activeCategory = 'ALL', minFitness = 0, searchQuery = '', currentView = 'grid';
    let sortField = 'fitness', sortDir = -1;
    let currentConnector = 'clipboard';
    let currentImportRepo = null;
    let currentModalRepo = null;
    let ghToken = localStorage.getItem('brainsty_gh_token') || '';

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showToast(msg, type = 'ok') {
      const t = document.getElementById('toast');
      t.textContent = msg; t.className = `toast show ${type}`;
      setTimeout(() => t.className = 'toast', 3000);
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const catStats = {};
    function initSideBar() {
      const catList = document.getElementById('cat-list');
      catList.innerHTML = '';
      const stats = {};
      REPOS.forEach(r => r.categories.forEach(c => { stats[c] = (stats[c] || 0) + 1; }));

      Object.keys(stats).sort((a, b) => stats[b] - stats[a]).forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'cat-btn'; btn.dataset.cat = cat;
        if (activeCategory === cat) btn.classList.add('active');
        btn.innerHTML = `<span style="display:flex;align-items:center;gap:8px"><span class="cat-dot" style="background:${CAT_COLORS[cat] || '#6b7280'}"></span>${CAT_LABELS[cat] || cat}</span><span class="cat-count">${stats[cat]}</span>`;
        btn.addEventListener('click', () => {
          document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active'); activeCategory = cat; render();
        });
        catList.appendChild(btn);
      });

      document.querySelector('[data-cat="ALL"]').addEventListener('click', () => {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        document.querySelector('[data-cat="ALL"]').classList.add('active');
        activeCategory = 'ALL'; render();
      });
    }
    document.querySelectorAll('.fit-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.fit-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active'); minFitness = parseInt(btn.dataset.min); render();
      });
    });
    document.getElementById('search').addEventListener('input', e => { searchQuery = e.target.value.toLowerCase(); render(); });
    document.querySelectorAll('.view-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active'); currentView = btn.dataset.view;
        document.getElementById('grid-view').style.display = currentView === 'grid' ? 'grid' : 'none';
        document.getElementById('table-view').style.display = currentView === 'table' ? 'block' : 'none';
        render();
      });
    });
    document.querySelectorAll('.data-table th[data-sort]').forEach(th => {
      th.addEventListener('click', () => {
        if (sortField === th.dataset.sort) sortDir *= -1;
        else { sortField = th.dataset.sort; sortDir = -1; }
        render();
      });
    });

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ FILTER + RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function getFiltered() {
      return REPOS.filter(r => {
        if (activeCategory !== 'ALL' && !r.categories.includes(activeCategory)) return false;
        if (r.fitness < minFitness) return false;
        if (searchQuery) {
          const hay = (r.full_name + ' ' + r.tldr + ' ' + (r.innovation_idea || '') + ' ' + r.categories.join(' ')).toLowerCase();
          if (!hay.includes(searchQuery)) return false;
        }
        return true;
      }).sort((a, b) => {
        if (sortField === 'fitness') return (b.fitness - a.fitness) * sortDir * -1 || (b.stars || 0) - (a.stars || 0);
        if (sortField === 'stars') return ((b.stars || 0) - (a.stars || 0)) * sortDir * -1;
        if (sortField === 'full_name') return a.full_name.localeCompare(b.full_name) * sortDir * -1;
        return 0;
      });
    }

    function buildCatChart() {
      const chart = document.getElementById('cat-chart');
      const filtered = getFiltered();
      const counts = {};
      filtered.forEach(r => r.categories.forEach(c => { counts[c] = (counts[c] || 0) + 1; }));
      const max = Math.max(...Object.values(counts), 1);
      chart.innerHTML = Object.entries(counts).sort((a, b) => b[1] - a[1]).map(([cat, count]) =>
        `<div class="cat-bar-row" title="${CAT_LABELS[cat] || cat}">
      <div class="cat-bar-label">${CAT_LABELS[cat] || cat}</div>
      <div class="cat-bar-track"><div class="cat-bar-fill" style="width:${Math.round(count / max * 100)}%;background:${CAT_COLORS[cat] || '#6b7280'}"></div></div>
      <div class="cat-bar-num">${count}</div>
    </div>`).join('');
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ FIREBASE OPERATIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function loadRepos() {
      try {
        const snapshot = await db.collection('starred_repos').orderBy('fitness', 'desc').get();
        REPOS = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        initSideBar();
        render();
        updateCounts();
      } catch (e) {
        console.error("Firestore Load Error:", e);
        if (e.message.includes('database (default) does not exist')) {
          logLine('sync-log', '‚ùå Firestore Error: Database (default) not found. Please ensure Firestore is initialized in Native Mode in the Firebase Console.', 'err');
          openUpdatePanel('sync');
        } else {
          logLine('sync-log', `‚ùå Firestore Error: ${e.message}`, 'err');
        }
      }
    }

    async function updateRepoInFirestore(fullName, fields) {
      const docId = fullName.replace('/', '__');
      await db.collection('starred_repos').doc(docId).update(fields);
      const idx = REPOS.findIndex(r => r.full_name === fullName);
      if (idx >= 0) {
        REPOS[idx] = { ...REPOS[idx], ...fields };
        render();
      }
    }

    async function deleteRepoFromFirestore(fullName) {
      const docId = fullName.replace('/', '__');
      await db.collection('starred_repos').doc(docId).delete();
      REPOS = REPOS.filter(r => r.full_name !== fullName);
      render();
      updateCounts();
    }

    async function markAsViewed(fullName) {
      await updateRepoInFirestore(fullName, { is_new: false });
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ GITHUB SYNC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function fetchAllStarredRepos(token) {
      let allStars = [];
      let page = 1;
      const perPage = 100;

      // Use /user/starred (authenticated) which is more accurate/real-time
      const baseUrl = token ? 'https://api.github.com/user/starred' : 'https://api.github.com/users/MarceloDe/starred';

      while (true) {
        logLine('sync-log', `Fetching page ${page} of starred repos...`, 'info');
        const res = await fetch(`${baseUrl}?per_page=${perPage}&page=${page}`, {
          headers: {
            'Accept': 'application/vnd.github+json',
            ...(token ? { 'Authorization': `Bearer ${token}` } : {}),
            'X-GitHub-Api-Version': '2022-11-28'
          }
        });

        if (!res.ok) {
          const errData = await res.json().catch(() => ({}));
          throw new Error(`GitHub API ${res.status}: ${errData.message || res.statusText}`);
        }

        const data = await res.json();
        if (!Array.isArray(data)) break;

        allStars = allStars.concat(data);
        logLine('sync-log', `Received ${data.length} repos. Total so far: ${allStars.length}`, 'info');

        if (data.length < perPage || page >= 10) break;
        page++;
      }
      return allStars;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ INITIALIZATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function startup() {
      // Load token
      const savedToken = localStorage.getItem('brainsty_gh_token');
      if (savedToken) {
        ghToken = savedToken;
        document.getElementById('gh-token').value = '‚óè'.repeat(12);
        document.getElementById('token-indicator')?.classList.add('active');
      }

      // Load initial data
      await loadRepos();

      // Background discovery
      if (ghToken) {
        syncStars(); // Call the comprehensive sync function
      }
    }

    function updateCounts() {
      document.getElementById('total-count').textContent = REPOS.length;
      document.getElementById('fit5-count').textContent = REPOS.filter(r => r.fitness === 5).length;
      document.getElementById('fit4-count').textContent = REPOS.filter(r => r.fitness >= 4).length;
    }

    // Override existing functions to use Firestore
    async function saveRepo() {
      const fullName = document.getElementById('edit-full-name').value;
      const fields = {
        fitness: parseInt(document.getElementById('ef-fitness').value),
        language: document.getElementById('ef-language').value || null,
        tldr: document.getElementById('ef-tldr').value,
        categories: document.getElementById('ef-categories').value.split(',').map(s => s.trim()).filter(Boolean),
        innovation_idea: document.getElementById('ef-innovation').value
      };

      try {
        await updateRepoInFirestore(fullName, fields);
        showToast(`‚úì Saved to Firestore: ${fullName}`, 'ok');
        document.getElementById('edit-form').style.display = 'none';
      } catch (e) {
        showToast(`Error saving: ${e.message}`, 'err');
      }
    }

    async function deleteRepo() {
      const fullName = document.getElementById('edit-full-name').value;
      if (!confirm(`Delete ${fullName} from Firestore?`)) return;
      try {
        await deleteRepoFromFirestore(fullName);
        showToast(`Deleted from Firestore: ${fullName}`, 'warn');
        document.getElementById('edit-form').style.display = 'none';
      } catch (e) {
        showToast(`Error deleting: ${e.message}`, 'err');
      }
    }

    function saveToken() {
      const token = document.getElementById('gh-token').value.trim();
      if (token && !token.startsWith('‚óè')) {
        ghToken = token;
        localStorage.setItem('brainsty_gh_token', token);
        document.getElementById('token-indicator')?.classList.add('active');
        showToast('‚úì Token saved to localStorage', 'ok');
      } else if (!token) {
        ghToken = '';
        localStorage.removeItem('brainsty_gh_token');
        document.getElementById('token-indicator')?.classList.remove('active');
        showToast('Token cleared', 'warn');
      }
    }

    function render() {
      const filtered = getFiltered();
      document.getElementById('result-count').textContent = `${filtered.length} repos`;
      document.getElementById('all-count').textContent = filtered.length;
      buildCatChart();
      if (currentView === 'grid') {
        const grid = document.getElementById('grid-view');
        if (!filtered.length) { grid.innerHTML = '<div class="empty-state">No repos match the current filters.</div>'; return; }
        grid.innerHTML = filtered.map((r, i) => {
          const catColor = r.categories[0] ? (CAT_COLORS[r.categories[0]] || '#6b7280') : '#6b7280';
          const tags = r.categories.map(c => `<span class="tag" style="color:${CAT_COLORS[c] || '#6b7280'};border-color:${CAT_COLORS[c] || '#6b7280'}30;background:${CAT_COLORS[c] || '#6b7280'}0d">${CAT_LABELS[c] || c}</span>`).join('');
          const langColor = LANG_COLORS[r.language] || '#6b7280';
          const starsK = r.stars >= 1000 ? (r.stars / 1000).toFixed(1) + 'k' : (r.stars || 0);
          const fitColor = r.fitness >= 5 ? '#fbbf24' : r.fitness >= 4 ? '#10b981' : r.fitness >= 3 ? '#60a5fa' : '#6b7280';
          const rjson = JSON.stringify(r).replace(/'/g, "&#39;").replace(/"/g, '&quot;');
          return `<div class="repo-card" style="--cat-color:${catColor};animation-delay:${i * 0.02}s" onclick="openModal(REPOS.find(x=>x.full_name===&quot;${r.full_name}&quot;))">
        <div class="card-header">
          <div class="repo-name"><a href="${r.html_url}" target="_blank" onclick="event.stopPropagation()">${r.full_name.split('/')[1]}<br><small style="font-weight:400;color:var(--muted);font-size:10px">${r.full_name.split('/')[0]}</small></a></div>
          <div class="fitness-badge"><span style="color:${fitColor};font-family:'Space Mono',monospace;font-size:12px">${r.fitness}‚òÖ</span></div>
        </div>
        <p class="card-tldr">${r.tldr || 'No description'}</p>
        <div class="card-tags">${tags}</div>
        <div class="card-actions">
          ${r.innovation_idea ? `<button class="innovation-btn" onclick="event.stopPropagation();openModal(REPOS.find(x=>x.full_name===&quot;${r.full_name}&quot;))">üí° Idea</button>` : ''}
          <button class="import-btn" onclick="event.stopPropagation();openImportPanel(REPOS.find(x=>x.full_name===&quot;${r.full_name}&quot;))">‚¨Ü Import to Claude</button>
        </div>
        <div class="card-footer">
          <span class="lang-dot" style="background:${langColor}"></span>
          <span>${r.language || '‚Äî'}</span>
          <span class="stars-count">‚òÖ ${starsK}</span>
        </div>
      </div>`;
        }).join('');
      } else {
        document.getElementById('table-body').innerHTML = filtered.map(r => {
          const starsK = r.stars >= 1000 ? (r.stars / 1000).toFixed(1) + 'k' : (r.stars || 0);
          const tags = r.categories.map(c => `<span class="tag" style="color:${CAT_COLORS[c] || '#6b7280'};border-color:${CAT_COLORS[c] || '#6b7280'}30;background:${CAT_COLORS[c] || '#6b7280'}0d;font-size:9px">${CAT_LABELS[c] || c}</span>`).join('');
          const fitColor = r.fitness >= 5 ? '#fbbf24' : r.fitness >= 4 ? '#10b981' : r.fitness >= 3 ? '#60a5fa' : '#6b7280';
          return `<tr>
        <td><a href="${r.html_url}" target="_blank">${r.full_name}</a></td>
        <td><span style="color:${fitColor};font-family:'Space Mono',monospace">${r.fitness}‚òÖ</span></td>
        <td style="font-family:'Space Mono',monospace;font-size:11px">${starsK}</td>
        <td style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted)">${r.language || '‚Äî'}</td>
        <td style="max-width:200px"><div style="display:flex;flex-wrap:wrap;gap:3px">${tags}</div></td>
        <td style="max-width:260px;font-size:11px;color:#c4b5fd">${r.innovation_idea ? r.innovation_idea.slice(0, 80) + '‚Ä¶' : '‚Äî'}</td>
        <td><button class="import-btn" onclick="openImportPanel(REPOS.find(x=>x.full_name==='${r.full_name}'))" style="font-size:9px;padding:3px 6px">‚¨Ü Import</button></td>
      </tr>`;
        }).join('');
      }
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const modal = document.getElementById('modal');
    document.getElementById('modal-close').addEventListener('click', () => modal.classList.remove('open'));
    modal.addEventListener('click', e => { if (e.target === modal) modal.classList.remove('open'); });

    function openModal(repo) {
      if (!repo) return;
      currentModalRepo = repo;
      document.getElementById('m-name').innerHTML = `<a href="${repo.html_url}" target="_blank">${repo.full_name}</a>`;
      document.getElementById('m-sub').textContent = `${repo.language || '‚Äî'} ¬∑ ‚òÖ ${(repo.stars || 0).toLocaleString()} ¬∑ Fitness ${repo.fitness}/5`;
      document.getElementById('m-tldr').textContent = repo.tldr || 'No description';
      const innoSection = document.getElementById('m-inno-section');
      if (repo.innovation_idea) { document.getElementById('m-inno').textContent = repo.innovation_idea; innoSection.style.display = 'block'; } else { innoSection.style.display = 'none'; }
      const catsEl = document.getElementById('m-cats');
      catsEl.innerHTML = repo.categories.map(c => `<span class="tag" style="color:${CAT_COLORS[c] || '#6b7280'};border-color:${CAT_COLORS[c] || '#6b7280'}22;background:${CAT_COLORS[c] || '#6b7280'}11">${CAT_LABELS[c] || c}</span>`).join('');
      modal.classList.add('open');
    }

    function openImportFromModal() {
      modal.classList.remove('open');
      if (currentModalRepo) openImportPanel(currentModalRepo);
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ UPDATE PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function openUpdatePanel(tab) {
      document.getElementById('update-panel').classList.add('open');
      switchTab(tab, document.querySelector(`.ptab[data-tab="${tab}"]`));
    }
    function closeUpdatePanel() { document.getElementById('update-panel').classList.remove('open'); }

    function switchTab(name, el) {
      document.querySelectorAll('.ptab').forEach(t => t.classList.remove('active'));
      if (el) el.classList.add('active');
      ['sync', 'add', 'edit', 'export', 'connectors'].forEach(t => {
        const el = document.getElementById(`tab-${t}`);
        if (el) el.style.display = t === name ? 'block' : 'none';
      });
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ GITHUB API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function ghHeaders() {
      const h = { 'Accept': 'application/vnd.github+json' };
      if (ghToken) h['Authorization'] = `Bearer ${ghToken}`;
      return h;
    }

    async function fetchGitHubRepo(fullName) {
      const r = await fetch(`https://api.github.com/repos/${fullName}`, { headers: ghHeaders() });
      if (!r.ok) throw new Error(`GitHub API ${r.status}: ${fullName}`);
      return r.json();
    }

    async function fetchREADME(fullName) {
      // Try multiple branches and paths
      const branches = ['main', 'master'];
      const paths = ['README.md', 'readme.md', 'README.MD', 'README.rst', 'README.txt', 'README'];
      for (const branch of branches) {
        for (const path of paths) {
          try {
            const url = `https://raw.githubusercontent.com/${fullName}/${branch}/${path}`;
            const r = await fetch(url);
            if (r.ok) {
              const text = await r.text();
              return text.length > 50 ? text : null;
            }
          } catch (e) { }
        }
      }
      // Fallback: GitHub API content endpoint
      try {
        const r = await fetch(`https://api.github.com/repos/${fullName}/readme`, { headers: ghHeaders() });
        if (r.ok) {
          const d = await r.json();
          if (d.content) return atob(d.content.replace(/\n/g, ''));
        }
      } catch (e) { }
      return null;
    }

    function logLine(logId, msg, type = 'info') {
      const el = document.getElementById(logId);
      if (!el) return;
      const d = document.createElement('div');
      d.className = `log-line ${type}`;
      d.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      el.appendChild(d);
      el.scrollTop = el.scrollHeight;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SYNC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function starOnGitHub(fullName) {
      if (!ghToken) return;
      try {
        const res = await fetch(`https://api.github.com/user/starred/${fullName}`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${ghToken}`,
            'Content-Length': '0',
            'Accept': 'application/vnd.github+json',
            'X-GitHub-Api-Version': '2022-11-28'
          }
        });
        return res.ok;
      } catch (e) { return false; }
    }

    async function syncStars() {
      if (!ghToken) { openUpdatePanel('connectors'); return; }
      const log = document.getElementById('sync-log');
      log.innerHTML = '';
      const progWrap = document.getElementById('sync-progress-wrap');
      const prog = document.getElementById('sync-progress');
      progWrap.style.display = 'block';
      logLine('sync-log', `Starting Full Galaxy Sync...`, 'info');

      try {
        // If ghToken is present, fetch stars for the authenticated user.
        // Otherwise, if 'MarceloDe' is hardcoded, it implies fetching public stars.
        // Assuming fetchAllStarredRepos now takes only ghToken if it's for the authenticated user.
        const githubStars = await fetchAllStarredRepos(ghToken);
        logLine('sync-log', `Found ${githubStars.length} stars on GitHub. Syncing with database...`, 'ok');

        // Use a lowercase map to avoid case-sensitivity issues with repo names
        const existingMap = new Map(REPOS.map(r => [r.full_name.toLowerCase(), r]));
        let updatedCount = 0, addedCount = 0, failedCount = 0;

        for (let i = 0; i < githubStars.length; i++) {
          const s = githubStars[i];
          prog.style.width = `${Math.round((i / githubStars.length) * 100)}%`;
          if (i % 10 === 0) logLine('sync-log', `Processing ${i + 1}/${githubStars.length}...`, 'info');

          try {
            const docId = s.full_name.replace('/', '__');
            const existing = existingMap.get(s.full_name.toLowerCase());

            const data = {
              full_name: s.full_name,
              stars: s.stargazers_count,
              html_url: s.html_url,
              language: s.language || null,
              last_synced: firebase.firestore.FieldValue.serverTimestamp()
            };

            if (existing) {
              // Update existing
              await db.collection('starred_repos').doc(docId).update(data);
              Object.assign(existing, data);
              updatedCount++;
            } else {
              // Add new
              const newRepoData = {
                ...data,
                categories: autoClassify(s),
                tldr: s.description || '',
                fitness: 3,
                innovation_idea: '',
                added_at: firebase.firestore.FieldValue.serverTimestamp(),
                is_new: true
              };
              await db.collection('starred_repos').doc(docId).set(newRepoData);
              REPOS.unshift({ id: docId, ...newRepoData });
              addedCount++;
            }
          } catch (e) {
            failedCount++;
            logLine('sync-log', `‚ö† ${s.full_name}: ${e.message}`, 'warn');
          }
        }

        prog.style.width = '100%';
        logLine('sync-log', `‚úì Sync complete: ${addedCount} added, ${updatedCount} updated, ${failedCount} failed`, 'ok');
        showToast(`‚úì Sync complete: ${addedCount} added, ${updatedCount} updated`, 'ok');
        initSideBar();
        render();
        updateCounts();
      } catch (e) {
        logLine('sync-log', `Critical Sync Error: ${e.message}`, 'err');
      }
    }

    function syncSingle() {
      const row = document.getElementById('single-sync-row');
      row.style.display = row.style.display === 'none' ? 'flex' : 'none';
    }

    async function doSyncSingle() {
      const input = document.getElementById('single-sync-input').value.trim();
      const fullName = input.replace(/^https?:\/\/github\.com\//, '').replace(/\.git$/, '').replace(/\/$/, '');
      if (!fullName.includes('/')) { showToast('Enter owner/repo format', 'err'); return; }
      try {
        logLine('sync-log', `Fetching ${fullName}‚Ä¶`, 'info');
        const data = await fetchGitHubRepo(fullName);
        const docId = data.full_name.replace('/', '__');

        const updates = {
          stars: data.stargazers_count,
          language: data.language || null,
          last_synced: firebase.firestore.FieldValue.serverTimestamp()
        };

        // Update Firestore
        await db.collection('starred_repos').doc(docId).set(updates, { merge: true });

        const idx = REPOS.findIndex(r => r.full_name === fullName);
        if (idx >= 0) {
          Object.assign(REPOS[idx], updates);
          logLine('sync-log', `‚úì Updated ${fullName}: ${data.stargazers_count} stars`, 'ok');
          showToast(`‚òÖ ${data.stargazers_count}`, 'ok');
          render();
        } else {
          logLine('sync-log', `‚ö† ${fullName} not in database. Use Add Repo to add it.`, 'warn');
        }
      } catch (e) { logLine('sync-log', `‚úó Error: ${e.message}`, 'err'); }
    }

    async function syncMeta() {
      document.getElementById('sync-log').innerHTML = '';
      logLine('sync-log', 'Fetching metadata for all repos‚Ä¶', 'info');
      let done = 0;
      const delay = ms => new Promise(r => setTimeout(r, ms));
      for (let i = 0; i < REPOS.length; i++) {
        const repo = REPOS[i];
        try {
          const data = await fetchGitHubRepo(repo.full_name);
          const updates = {
            language: data.language || repo.language,
            tldr: data.description || repo.tldr,
            last_synced: firebase.firestore.FieldValue.serverTimestamp()
          };

          await db.collection('starred_repos').doc(repo.id).update(updates);
          Object.assign(repo, updates);
          done++;
        } catch (e) { }
        if (i % 10 === 9 && !ghToken) await delay(1200);
      }
      logLine('sync-log', `‚úì Meta sync done ‚Äî ${done}/${REPOS.length}`, 'ok');
      showToast('Metadata refreshed', 'ok');
      render();
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ADD REPO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function addRepo() {
      const input = document.getElementById('add-repo-input').value.trim();
      const fullName = input.replace(/^https?:\/\/github\.com\//, '').replace(/\.git$/, '').replace(/\/$/, '').replace(/^@/, '');
      if (!fullName.includes('/')) { showToast('Use owner/repo format', 'err'); return; }
      if (REPOS.find(r => r.full_name === fullName)) { showToast('Repo already in database', 'warn'); return; }
      try {
        logLine('add-log', `Fetching ${fullName} from GitHub‚Ä¶`, 'info');
        const data = await fetchGitHubRepo(fullName);
        const docId = data.full_name.replace('/', '__');

        const newRepo = {
          full_name: data.full_name,
          categories: autoClassify(data),
          tldr: data.description || '',
          fitness: 3,
          innovation_idea: '',
          html_url: data.html_url,
          stars: data.stargazers_count,
          language: data.language || null,
          added_at: firebase.firestore.FieldValue.serverTimestamp(),
          last_synced: firebase.firestore.FieldValue.serverTimestamp(),
          is_new: true
        };

        // Save to Firestore
        await db.collection('starred_repos').doc(docId).set(newRepo);
        REPOS.unshift({ id: docId, ...newRepo });

        // Optional: Star on GitHub if token present
        if (ghToken) {
          logLine('add-log', `Starring ${fullName} on your GitHub account‚Ä¶`, 'info');
          await starOnGitHub(fullName);
        }

        logLine('add-log', `‚úì Added and synced ${data.full_name}`, 'ok');
        showToast(`Added ${data.full_name}`, 'ok');
        updateCounts();
        initSideBar();
        render();
        document.getElementById('add-repo-input').value = '';
      } catch (e) {
        logLine('add-log', `‚úó Error: ${e.message}`, 'err');
        showToast(`Error adding: ${e.message}`, 'err');
      }
    }

    function bulkImport() {
      try {
        const raw = document.getElementById('bulk-json-input').value.trim();
        const arr = JSON.parse(raw);
        if (!Array.isArray(arr)) throw new Error('Expected JSON array');
        let added = 0, updated = 0;
        arr.forEach(item => {
          if (!item.full_name) return;
          const idx = REPOS.findIndex(r => r.full_name === item.full_name);
          if (idx >= 0) { Object.assign(REPOS[idx], item); updated++; }
          else { REPOS.push({ categories: [], fitness: 3, innovation_idea: '', stars: 0, ...item }); added++; }
        });
        showToast(`Imported: ${added} added, ${updated} updated`, 'ok');
        document.getElementById('total-count').textContent = REPOS.length;
        render();
      } catch (e) { showToast(`Parse error: ${e.message}`, 'err'); }
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ EDIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function filterEditList() {
      const q = document.getElementById('edit-search-input').value.toLowerCase();
      const list = document.getElementById('edit-list');
      const matches = REPOS.filter(r => r.full_name.toLowerCase().includes(q)).slice(0, 20);
      list.innerHTML = matches.map(r =>
        `<div style="padding:8px 10px;cursor:pointer;border-bottom:1px solid var(--border);font-size:12px;display:flex;justify-content:space-between;align-items:center" onmouseover="this.style.background='var(--border)'" onmouseout="this.style.background=''" onclick="loadEditForm('${r.full_name}')">
      <span>${r.full_name}</span>
      <span style="font-family:'Space Mono',monospace;font-size:10px;color:#fbbf24">${r.fitness}‚òÖ</span>
    </div>`
      ).join('');
    }

    function loadEditForm(fullName) {
      const r = REPOS.find(x => x.full_name === fullName);
      if (!r) return;
      document.getElementById('edit-full-name').value = fullName;
      document.getElementById('ef-fitness').value = r.fitness;
      document.getElementById('ef-language').value = r.language || '';
      document.getElementById('ef-tldr').value = r.tldr || '';
      document.getElementById('ef-categories').value = r.categories.join(',');
      document.getElementById('ef-innovation').value = r.innovation_idea || '';
      document.getElementById('edit-form').style.display = 'block';
      document.getElementById('edit-list').innerHTML = `<div style="padding:8px 10px;background:var(--accent)10;border:1px solid var(--accent)40;border-radius:6px;font-size:12px;color:var(--accent);font-family:'Space Mono',monospace">${fullName}</div>`;
    }

    function saveEdit() {
      const fullName = document.getElementById('edit-full-name').value;
      const idx = REPOS.findIndex(r => r.full_name === fullName);
      if (idx < 0) return;
      REPOS[idx].fitness = parseInt(document.getElementById('ef-fitness').value);
      REPOS[idx].language = document.getElementById('ef-language').value || null;
      REPOS[idx].tldr = document.getElementById('ef-tldr').value;
      REPOS[idx].categories = document.getElementById('ef-categories').value.split(',').map(s => s.trim()).filter(Boolean);
      REPOS[idx].innovation_idea = document.getElementById('ef-innovation').value;
      showToast(`‚úì Saved ${fullName}`, 'ok');
      document.getElementById('edit-form').style.display = 'none';
      document.getElementById('edit-search-input').value = '';
      document.getElementById('edit-list').innerHTML = '';
      render();
      document.getElementById('fit5-count').textContent = REPOS.filter(r => r.fitness === 5).length;
      document.getElementById('fit4-count').textContent = REPOS.filter(r => r.fitness >= 4).length;
    }

    function deleteRepo() {
      const fullName = document.getElementById('edit-full-name').value;
      if (!confirm(`Delete ${fullName} from database?`)) return;
      const idx = REPOS.findIndex(r => r.full_name === fullName);
      if (idx >= 0) { REPOS.splice(idx, 1); showToast(`Deleted ${fullName}`, 'warn'); render(); }
      document.getElementById('edit-form').style.display = 'none';
      document.getElementById('total-count').textContent = REPOS.length;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ EXPORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function exportJSON() {
      const blob = new Blob([JSON.stringify(REPOS, null, 2)], { type: 'application/json' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
      a.download = 'brainsty-repos.json'; a.click();
      showToast('Downloaded repos.json', 'ok');
    }

    function copyJSON() {
      navigator.clipboard.writeText(JSON.stringify(REPOS, null, 2)).then(() => showToast('JSON copied!', 'ok'));
    }

    function exportCSV() {
      const headers = ['full_name', 'fitness', 'stars', 'language', 'categories', 'tldr', 'innovation_idea', 'html_url'];
      const rows = REPOS.map(r => headers.map(h => {
        const v = h === 'categories' ? r.categories.join('|') : (r[h] || '');
        return `"${String(v).replace(/"/g, '""')}"`;
      }).join(','));
      const blob = new Blob([[headers.join(','), ...rows].join('\n')], { type: 'text/csv' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
      a.download = 'brainsty-repos.csv'; a.click();
      showToast('Downloaded repos.csv', 'ok');
    }

    function exportHTML() {
      // Generate full self-contained HTML with updated REPOS
      const currentHTML = document.documentElement.outerHTML;
      const reposStr = JSON.stringify(REPOS);
      const updated = currentHTML.replace(/let REPOS = \[[\s\S]*?\];/, `const REPOS = ${reposStr};`);
      const blob = new Blob([updated], { type: 'text/html' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
      a.download = 'brainsty-stars-map-updated.html'; a.click();
      showToast('Downloaded updated HTML', 'ok');
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CONNECTORS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const CONNECTOR_DESCS = {
      'clipboard': 'üìã Copy Context ‚Äî fetches README via GitHub raw URL and copies formatted context to clipboard for pasting into Claude chat.',
      'download': '‚¨á Download .md ‚Äî fetches README and packages it as a markdown context file. Upload to Claude.ai as a document.',
      'claude-web': 'üåê Claude.ai Web ‚Äî opens claude.ai/new with a pre-written prompt asking Claude to analyze the repo.',
      'mcp': 'üîå MCP Config ‚Äî generates a claude_desktop_config.json snippet using git-mcp.com as the MCP server endpoint.',
      'git-mcp': 'üêô git-mcp Server ‚Äî opens git-mcp.com for the repo, turning it into a live MCP endpoint readable by Claude Desktop.',
      'github-dev': 'üíª github.dev ‚Äî opens the repo in VS Code Web (github.dev) for manual browsing and copying.',
    };

    function selectConnector(name, el) {
      currentConnector = name;
      document.querySelectorAll('.connector-card').forEach(c => c.classList.remove('selected'));
      el.classList.add('selected');
      document.getElementById('active-connector-desc').textContent = CONNECTOR_DESCS[name] || name;
    }


    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ BATCH IMPORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function batchImport() {
      const minFit = parseInt(document.getElementById('batch-fitness').value);
      const targets = REPOS.filter(r => r.fitness >= minFit);
      const log = document.getElementById('batch-log');
      log.innerHTML = '';
      logLine('batch-log', `Batch importing ${targets.length} repos using connector: ${currentConnector}`, 'info');

      if (currentConnector === 'clipboard') {
        let allContext = `# Brainsty GitHub Stars ‚Äî Batch Context Pack\nGenerated: ${new Date().toISOString()}\nFitness >= ${minFit}\n\n---\n\n`;
        let done = 0;
        for (const repo of targets) {
          try {
            const readme = await fetchREADME(repo.full_name);
            allContext += buildContextText(repo, readme);
            allContext += '\n---\n\n';
            done++;
            if (done % 5 === 0) logLine('batch-log', `Fetched ${done}/${targets.length}‚Ä¶`, 'info');
          } catch (e) {
            allContext += buildContextText(repo, null);
            allContext += '\n---\n\n';
          }
        }
        try {
          await navigator.clipboard.writeText(allContext);
          logLine('batch-log', `‚úì Copied ${done} repos to clipboard (${Math.round(allContext.length / 1024)}KB)`, 'ok');
          showToast(`Copied ${done} repos`, 'ok');
        } catch (e) { logLine('batch-log', '‚úó Clipboard error ‚Äî downloading instead', 'err'); downloadText(allContext, 'batch-context.md'); }
      } else if (currentConnector === 'download') {
        let allContext = `# Brainsty GitHub Stars ‚Äî Batch Context Pack\nFitness >= ${minFit}\n\n---\n\n`;
        for (const repo of targets) {
          const readme = await fetchREADME(repo.full_name).catch(() => null);
          allContext += buildContextText(repo, readme);
          allContext += '\n---\n\n';
        }
        downloadText(allContext, `brainsty-context-f${minFit}plus.md`);
        logLine('batch-log', `‚úì Downloaded context for ${targets.length} repos`, 'ok');
      } else if (currentConnector === 'mcp') {
        const servers = {};
        targets.forEach(r => {
          const key = r.full_name.replace('/', '--');
          servers[`github-${key}`] = { command: 'npx', args: ['-y', 'git-mcp', r.html_url], env: {} };
        });
        const config = JSON.stringify({ mcpServers: servers }, null, 2);
        downloadText(config, 'claude_desktop_config_batch.json');
        logLine('batch-log', `‚úì Generated MCP config for ${targets.length} repos. Add to ~/Library/Application Support/Claude/claude_desktop_config.json`, 'ok');
      } else {
        logLine('batch-log', `‚ö† Batch not supported for connector: ${currentConnector}. Use individual Import buttons.`, 'warn');
      }
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ IMPORT PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function openImportPanel(repo) {
      if (!repo) return;
      currentImportRepo = repo;
      document.getElementById('import-repo-badge').innerHTML = `üêô <span>${repo.full_name}</span> <span style="color:var(--muted)">‚òÖ${(repo.stars || 0).toLocaleString()}</span>`;
      document.getElementById('import-log').innerHTML = 'Select an import method above‚Ä¶';
      document.getElementById('import-result-box').classList.remove('visible');
      document.getElementById('import-panel-overlay').classList.add('open');
    }

    function closeImportPanel() {
      document.getElementById('import-panel-overlay').classList.remove('open');
      currentImportRepo = null;
    }
    document.getElementById('import-panel-overlay').addEventListener('click', e => {
      if (e.target === document.getElementById('import-panel-overlay')) closeImportPanel();
    });

    async function doImport(method) {
      const repo = currentImportRepo;
      if (!repo) return;
      const logEl = document.getElementById('import-log');
      logEl.innerHTML = `<div class="log-line info">‚ü≥ Fetching context for ${repo.full_name}‚Ä¶</div>`;

      if (method === 'github-dev') {
        window.open(`https://github.dev/${repo.full_name}`, '_blank');
        logEl.innerHTML = `<div class="log-line ok">‚úì Opened github.dev ‚Äî browse files and copy content to Claude</div>`;
        return;
      }

      if (method === 'claude-web') {
        const prompt = encodeURIComponent(`Please analyze this GitHub repository and act as an expert guide for it: ${repo.html_url}\n\nRepository: ${repo.full_name}\nDescription: ${repo.tldr}\n\nFor Brainsty Healthcare: ${repo.innovation_idea || 'Help me understand how to integrate this into my healthcare navigation platform.'}`);
        window.open(`https://claude.ai/new?q=${prompt}`, '_blank');
        logEl.innerHTML = `<div class="log-line ok">‚úì Opened Claude.ai with pre-loaded prompt for ${repo.full_name}</div>`;
        return;
      }

      if (method === 'git-mcp') {
        window.open(`https://git-mcp.com/${repo.full_name}`, '_blank');
        const config = JSON.stringify({ mcpServers: { [`github-${repo.full_name.replace('/', '--')}`]: { command: 'npx', args: ['-y', 'git-mcp', repo.html_url], env: {} } } }, null, 2);
        showImportResult('üîå git-mcp Endpoint\n\nAdd to claude_desktop_config.json:\n\n' + config, 'MCP Config');
        logEl.innerHTML = `<div class="log-line ok">‚úì Opened git-mcp.com ‚Äî MCP config generated below</div>`;
        return;
      }

      if (method === 'mcp') {
        const serverName = `github-${repo.full_name.replace('/', '--')}`;
        const config = { mcpServers: { [serverName]: { command: 'npx', args: ['-y', 'git-mcp', repo.html_url], env: {} } } };
        const output = `// Add this to your claude_desktop_config.json:\n// Location: ~/Library/Application Support/Claude/claude_desktop_config.json\n// (macOS) or %APPDATA%\\Claude\\claude_desktop_config.json (Windows)\n\n${JSON.stringify(config, null, 2)}\n\n// To use with npx (no install needed):\n// npx -y git-mcp ${repo.html_url}\n\n// Alternative: Use mcp-remote to expose any URL:\n// npx -y @anthropic/mcp-remote https://git-mcp.com/${repo.full_name}`;
        showImportResult(output, 'üîå Claude Desktop MCP Config');
        logEl.innerHTML = `<div class="log-line ok">‚úì MCP config generated ‚Äî copy and add to Claude Desktop config file</div>`;
        return;
      }

      // For clipboard and download, fetch the README
      try {
        logEl.innerHTML = `<div class="log-line info">‚ü≥ Fetching README from GitHub raw‚Ä¶</div>`;
        const readme = await fetchREADME(repo.full_name);
        const context = buildContextText(repo, readme);
        logEl.innerHTML += `<div class="log-line ok">‚úì README fetched (${Math.round(context.length / 1024)}KB)</div>`;

        if (method === 'clipboard') {
          try {
            await navigator.clipboard.writeText(context);
            logEl.innerHTML += `<div class="log-line ok">‚úì Copied to clipboard ‚Äî paste into Claude.ai or Claude Desktop</div>`;
            showToast('Context copied!', 'ok');
          } catch (e) {
            logEl.innerHTML += `<div class="log-line warn">‚ö† Clipboard blocked ‚Äî showing text below for manual copy</div>`;
          }
          showImportResult(context, 'üìã Context for Claude');
        } else if (method === 'download') {
          downloadText(context, `${repo.full_name.replace('/', '--')}-context.md`);
          logEl.innerHTML += `<div class="log-line ok">‚úì Downloaded ‚Äî upload this .md file to Claude.ai as a document</div>`;
          showImportResult(context, '‚¨á Downloaded Context Preview');
        }
      } catch (e) {
        logEl.innerHTML += `<div class="log-line err">‚úó Error: ${e.message}</div>`;
        // Still show metadata context
        const fallback = buildContextText(repo, null);
        showImportResult(fallback, '‚ö† Metadata Only (README unavailable)');
      }
    }

    function buildContextText(repo, readme) {
      const sections = [
        `# GitHub Repository Context for Claude`,
        `## ${repo.full_name}`,
        `**URL:** ${repo.html_url}`,
        `**Stars:** ${(repo.stars || 0).toLocaleString()}`,
        `**Language:** ${repo.language || 'Unknown'}`,
        `**Fitness Score (Brainsty):** ${repo.fitness}/5`,
        ``,
        `## Description`,
        repo.tldr || 'No description available.',
        ``,
        `## Categories`,
        repo.categories.map(c => `- ${CAT_LABELS[c] || c}`).join('\n') || '- Uncategorized',
        ``,
      ];
      if (repo.innovation_idea) {
        sections.push(`## Brainsty Integration Idea\n${repo.innovation_idea}\n`);
      }
      if (readme) {
        sections.push(`## README\n\n${readme.slice(0, 12000)}${readme.length > 12000 ? '\n\n[README truncated at 12,000 chars]' : ''}`);
      } else {
        sections.push(`## README\n\n[README not available ‚Äî visit ${repo.html_url} for full documentation]`);
      }
      sections.push(`\n---\n*Context generated by Brainsty Stars Map on ${new Date().toLocaleString()}*`);
      return sections.join('\n');
    }

    function showImportResult(text, title) {
      document.getElementById('import-result-title').textContent = title;
      document.getElementById('import-result-text').value = text;
      document.getElementById('import-result-box').classList.add('visible');
    }

    function copyImportResult() {
      const ta = document.getElementById('import-result-text');
      navigator.clipboard.writeText(ta.value).then(() => {
        const c = document.getElementById('copy-confirm');
        c.style.display = 'block';
        setTimeout(() => c.style.display = 'none', 2000);
        showToast('Copied!', 'ok');
      }).catch(() => { ta.select(); document.execCommand('copy'); showToast('Copied!', 'ok'); });
    }

    function downloadImportResult() {
      const text = document.getElementById('import-result-text').value;
      const name = currentImportRepo ? `${currentImportRepo.full_name.replace('/', '--')}-context.md` : 'context.md';
      downloadText(text, name);
    }

    function downloadText(text, filename) {
      const blob = new Blob([text], { type: 'text/markdown' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename; a.click();
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    window.onload = startup;
  </script>
</body>

</html>